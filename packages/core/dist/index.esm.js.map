{"version":3,"file":"index.esm.js","sources":["../src/security-utils.ts","../src/chatbot-core.ts","../src/advanced-features.ts"],"sourcesContent":["/**\r\n * Security utilities for the chatbot\r\n * Provides functions to sanitize inputs, validate files, and prevent common attacks\r\n */\r\n\r\nexport class SecurityUtils {\r\n  /**\r\n   * Sanitize HTML content to prevent XSS attacks\r\n   * @param input - The input string to sanitize\r\n   * @returns Sanitized string safe for HTML insertion\r\n   */\r\n  static sanitizeHTML(input: string): string {\r\n    if (!input || typeof input !== 'string') return '';\r\n    \r\n    // Guard against SSR environments\r\n    if (typeof document === 'undefined') {\r\n      // Fallback for SSR: basic HTML entity encoding\r\n      return input\r\n        .replace(/&/g, '&amp;')\r\n        .replace(/</g, '&lt;')\r\n        .replace(/>/g, '&gt;')\r\n        .replace(/\"/g, '&quot;')\r\n        .replace(/'/g, '&#x27;');\r\n    }\r\n    \r\n    // Create a temporary div element to safely encode HTML entities\r\n    const div = document.createElement('div');\r\n    div.textContent = input;\r\n    return div.innerHTML;\r\n  }\r\n\r\n  /**\r\n   * Sanitize HTML attributes to prevent attribute injection\r\n   * @param input - The attribute value to sanitize\r\n   * @returns Sanitized attribute value\r\n   */\r\n  static sanitizeAttribute(input: string): string {\r\n    if (!input || typeof input !== 'string') return '';\r\n    \r\n    // Remove potentially dangerous characters from attributes\r\n    return input\r\n      .replace(/[<>\"'&]/g, (match) => {\r\n        const entities: { [key: string]: string } = {\r\n          '<': '&lt;',\r\n          '>': '&gt;',\r\n          '\"': '&quot;',\r\n          \"'\": '&#x27;',\r\n          '&': '&amp;'\r\n        };\r\n        return entities[match] || match;\r\n      })\r\n      .substring(0, 1000); // Limit attribute length\r\n  }\r\n\r\n  /**\r\n   * Validate file type by checking actual MIME type\r\n   * @param file - The file to validate\r\n   * @param allowedTypes - Array of allowed MIME types\r\n   * @returns True if file type is allowed\r\n   */\r\n  static validateFileType(file: File, allowedTypes: string[]): boolean {\r\n    if (!file || !file.type) return false;\r\n    return allowedTypes.includes(file.type);\r\n  }\r\n\r\n  /**\r\n   * Validate file size\r\n   * @param file - The file to validate\r\n   * @param maxSize - Maximum allowed file size in bytes\r\n   * @returns True if file size is within limit\r\n   */\r\n  static validateFileSize(file: File, maxSize: number): boolean {\r\n    if (!file) return false;\r\n    return file.size <= maxSize;\r\n  }\r\n\r\n  /**\r\n   * Sanitize file name to prevent path traversal attacks\r\n   * @param fileName - The file name to sanitize\r\n   * @returns Sanitized file name\r\n   */\r\n  static sanitizeFileName(fileName: string): string {\r\n    if (!fileName || typeof fileName !== 'string') return 'unnamed';\r\n    \r\n    // Remove directory traversal attempts and dangerous characters\r\n    return fileName\r\n      .replace(/[\\/\\\\:*?\"<>|]/g, '_') // Replace dangerous characters\r\n      .replace(/\\.\\./g, '_') // Remove directory traversal\r\n      .replace(/^\\.+/, '') // Remove leading dots\r\n      .substring(0, 255) // Limit filename length\r\n      .trim() || 'unnamed';\r\n  }\r\n\r\n  /**\r\n   * Validate URL to prevent malicious redirects\r\n   * @param url - The URL to validate\r\n   * @param allowedDomains - Optional array of allowed domains\r\n   * @returns True if URL is safe\r\n   */\r\n  static validateURL(url: string, allowedDomains?: string[]): boolean {\r\n    if (!url || typeof url !== 'string') return false;\r\n    \r\n    try {\r\n      const urlObj = new URL(url);\r\n      \r\n      // Only allow http and https protocols\r\n      if (!['http:', 'https:'].includes(urlObj.protocol)) {\r\n        return false;\r\n      }\r\n      \r\n      // Check allowed domains if provided\r\n      if (allowedDomains && allowedDomains.length > 0) {\r\n        const hostname = urlObj.hostname.toLowerCase();\r\n        return allowedDomains.some(domain => \r\n          hostname === domain.toLowerCase() || \r\n          hostname.endsWith('.' + domain.toLowerCase())\r\n        );\r\n      }\r\n      \r\n      return true;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validate input length\r\n   * @param input - The input to validate\r\n   * @param maxLength - Maximum allowed length\r\n   * @returns True if input length is within limit\r\n   */\r\n  static validateLength(input: string, maxLength: number): boolean {\r\n    if (typeof input !== 'string') return false;\r\n    return input.length <= maxLength;\r\n  }\r\n\r\n  /**\r\n   * Rate limiter class to prevent abuse\r\n   */\r\n  static RateLimiter = class {\r\n    public timestamps: Map<string, number[]> = new Map();\r\n\r\n    /**\r\n     * Check if action is allowed based on rate limit\r\n     * @param key - Unique identifier for the rate limit (e.g., user ID, IP)\r\n     * @param limit - Maximum number of actions allowed\r\n     * @param windowMs - Time window in milliseconds\r\n     * @returns True if action is allowed\r\n     */\r\n    checkLimit(key: string, limit: number, windowMs: number = 60000): boolean {\r\n      const now = Date.now();\r\n      let userTimestamps = this.timestamps.get(key) || [];\r\n      \r\n      // Remove timestamps outside the window\r\n      userTimestamps = userTimestamps.filter(timestamp => \r\n        now - timestamp < windowMs\r\n      );\r\n      \r\n      if (userTimestamps.length >= limit) {\r\n        return false;\r\n      }\r\n      \r\n      userTimestamps.push(now);\r\n      this.timestamps.set(key, userTimestamps);\r\n      \r\n      return true;\r\n    }\r\n\r\n    /**\r\n     * Clean up old entries to prevent memory leaks\r\n     */\r\n    cleanup(): void {\r\n      const now = Date.now();\r\n      const oneHour = 3600000; // 1 hour\r\n      \r\n      for (const [key, timestamps] of this.timestamps.entries()) {\r\n        const validTimestamps = timestamps.filter(timestamp => \r\n          now - timestamp < oneHour\r\n        );\r\n        \r\n        if (validTimestamps.length === 0) {\r\n          this.timestamps.delete(key);\r\n        } else {\r\n          this.timestamps.set(key, validTimestamps);\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Generate a secure random ID\r\n   * @param length - Length of the ID (default: 16)\r\n   * @returns Random string ID\r\n   */\r\n  static generateSecureId(length: number = 16): string {\r\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n    let result = '';\r\n    \r\n    // Guard against SSR environments and use crypto API when available\r\n    if (typeof window !== 'undefined' && window.crypto && window.crypto.getRandomValues) {\r\n      const array = new Uint8Array(length);\r\n      window.crypto.getRandomValues(array);\r\n      \r\n      for (let i = 0; i < length; i++) {\r\n        result += chars[array[i] % chars.length];\r\n      }\r\n    } else {\r\n      // Fallback for older browsers and SSR environments\r\n      for (let i = 0; i < length; i++) {\r\n        result += chars[Math.floor(Math.random() * chars.length)];\r\n      }\r\n    }\r\n    \r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Validate and sanitize configuration object\r\n   * @param config - Configuration object to validate\r\n   * @returns Sanitized configuration object\r\n   */\r\n  static sanitizeConfig(config: any): any {\r\n    if (!config || typeof config !== 'object') return {};\r\n    \r\n    const sanitized: any = {};\r\n    \r\n    // Sanitize string properties\r\n    for (const [key, value] of Object.entries(config)) {\r\n      if (typeof value === 'string') {\r\n        sanitized[key] = this.sanitizeHTML(value);\r\n      } else if (typeof value === 'number' || typeof value === 'boolean') {\r\n        sanitized[key] = value;\r\n      } else if (Array.isArray(value)) {\r\n        sanitized[key] = value.map(item => \r\n          typeof item === 'string' ? this.sanitizeHTML(item) : item\r\n        );\r\n      } else if (value && typeof value === 'object') {\r\n        sanitized[key] = this.sanitizeConfig(value);\r\n      }\r\n    }\r\n    \r\n    return sanitized;\r\n  }\r\n}\r\n\r\n// Export default rate limiter instances\r\nexport const messageLimiter = new SecurityUtils.RateLimiter();\r\nexport const uploadLimiter = new SecurityUtils.RateLimiter();\r\nexport const globalLimiter = new SecurityUtils.RateLimiter();\r\n\r\n// Clean up rate limiters every 5 minutes\r\nif (typeof window !== 'undefined') {\r\n  setInterval(() => {\r\n    messageLimiter.cleanup();\r\n    uploadLimiter.cleanup();\r\n    globalLimiter.cleanup();\r\n  }, 300000); // 5 minutes\r\n}","import { ChatbotConfig, Message } from './types';\nimport { SecurityUtils, messageLimiter } from './security-utils';\n\nexport class ChatbotCore {\n  protected config: ChatbotConfig;\n  protected container: HTMLElement | null = null;\n  private _isOpen = false;\n  protected messages: Message[] = [];\n  protected eventListeners: Map<string, Function[]> = new Map();\n\n  // Public getter for isOpen status\n  public get isOpen(): boolean {\n    return this._isOpen;\n  }\n\n  constructor(config: ChatbotConfig) {\n    // Sanitize the config to prevent XSS attacks\n    this.config = { ...this.getDefaultConfig(), ...SecurityUtils.sanitizeConfig(config) };\n    this.init();\n  }\n\n  private getDefaultConfig(): ChatbotConfig {\n    return {\n      primaryColor: '#007bff',\n      secondaryColor: '#6c757d',\n      textColor: '#212529',\n      backgroundColor: '#ffffff',\n      position: 'bottom-right',\n      width: 350,\n      height: 500,\n      zIndex: 9999,\n      autoOpen: false,\n      greeting: 'Hello! How can I help you today?',\n      placeholder: 'Type your message...',\n      borderRadius: 12,\n      fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif'\n    };\n  }\n\n  private init(): void {\n    // Guard against SSR environments\n    if (typeof window === 'undefined' || typeof document === 'undefined') {\n      console.warn('Chatify.js: DOM not available, skipping initialization. This is normal in SSR environments.');\n      return;\n    }\n\n    this.createContainer();\n    this.createStyles();\n    this.bindEvents();\n    \n    if (this.config.greeting) {\n      this.addMessage({\n        id: SecurityUtils.generateSecureId(),\n        text: SecurityUtils.sanitizeHTML(this.config.greeting),\n        sender: 'bot',\n        timestamp: new Date()\n      });\n    }\n  }\n\n  private createContainer(): void {\n    if (typeof document === 'undefined') return;\n\n    this.container = document.createElement('div');\n    this.container.className = 'chatbot-widget';\n    this.container.innerHTML = this.getTemplate();\n    document.body.appendChild(this.container);\n  }\n\n  private createStyles(): void {\n    if (typeof document === 'undefined') return;\n    \n    // Prevent multiple style injections by using a unique ID\n    const styleId = 'chatbot-styles';\n    if (document.getElementById(styleId)) return;\n\n    const style = document.createElement('style');\n    style.id = styleId;\n    style.textContent = this.getStyles();\n    document.head.appendChild(style);\n  }\n\n  private getTemplate(): string {\n    // Sanitize all user-provided content to prevent XSS\n    const safePosition = SecurityUtils.sanitizeAttribute(this.config.position || 'bottom-right');\n    const safeLogo = this.config.logo ? SecurityUtils.validateURL(this.config.logo) \n      ? SecurityUtils.sanitizeAttribute(this.config.logo) \n      : '' : '';\n    const safeCompanyName = SecurityUtils.sanitizeHTML(this.config.companyName || 'Chat Support');\n    const safePlaceholder = SecurityUtils.sanitizeAttribute(this.config.placeholder || 'Type your message...');\n\n    return `\n      <div class=\"chatbot-container\" data-position=\"${safePosition}\">\n        <!-- Trigger Button -->\n        <button class=\"chatbot-trigger\" type=\"button\" aria-label=\"Open chat\">\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\">\n            <path d=\"M12 2C6.48 2 2 6.48 2 12C2 13.54 2.36 15.01 3 16.31L2 22L7.69 21C8.99 21.64 10.46 22 12 22C17.52 22 22 17.52 22 12S17.52 2 12 2Z\" fill=\"currentColor\"/>\n          </svg>\n        </button>\n\n        <!-- Chat Window -->\n        <div class=\"chatbot-window\">\n          <!-- Header -->\n          <div class=\"chatbot-header\">\n            ${safeLogo ? `<img src=\"${safeLogo}\" alt=\"Logo\" class=\"chatbot-logo\">` : ''}\n            <div class=\"chatbot-header-text\">\n              <h3>${safeCompanyName}</h3>\n              <span class=\"chatbot-status\">Online</span>\n            </div>\n            <button class=\"chatbot-close\" type=\"button\" aria-label=\"Close chat\">\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n                <path d=\"M15 5L5 15M5 5L15 15\" stroke=\"currentColor\" stroke-width=\"2\"/>\n              </svg>\n            </button>\n          </div>\n\n          <!-- Messages -->\n          <div class=\"chatbot-messages\" id=\"chatbot-messages\"></div>\n\n          <!-- Input -->\n          <div class=\"chatbot-input\">\n            <input \n              type=\"text\" \n              placeholder=\"${safePlaceholder}\" \n              id=\"chatbot-input\"\n              autocomplete=\"off\"\n              maxlength=\"1000\"\n            >\n            <button type=\"button\" id=\"chatbot-send\" aria-label=\"Send message\">\n              <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n                <path d=\"M18 2L9 11L18 2ZM18 2L12 18L9 11L2 8L18 2Z\" stroke=\"currentColor\" stroke-width=\"2\"/>\n              </svg>\n            </button>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n\n  protected getStyles(): string {\n    return `\n      .chatbot-widget * {\n        box-sizing: border-box;\n      }\n\n      .chatbot-container {\n        position: fixed;\n        font-family: ${this.config.fontFamily};\n        z-index: ${this.config.zIndex};\n      }\n\n      .chatbot-container[data-position=\"bottom-right\"] {\n        bottom: 20px;\n        right: 20px;\n      }\n\n      .chatbot-container[data-position=\"bottom-left\"] {\n        bottom: 20px;\n        left: 20px;\n      }\n\n      .chatbot-trigger {\n        width: 60px;\n        height: 60px;\n        border-radius: 50%;\n        border: none;\n        background: ${this.config.primaryColor};\n        color: white;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: transform 0.2s, box-shadow 0.2s;\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n      }\n\n      .chatbot-trigger:hover {\n        transform: scale(1.05);\n        box-shadow: 0 6px 20px rgba(0,0,0,0.2);\n      }\n\n      .chatbot-window {\n        position: absolute;\n        bottom: 70px;\n        right: 0;\n        width: ${typeof this.config.width === 'number' ? this.config.width + 'px' : this.config.width};\n        height: ${typeof this.config.height === 'number' ? this.config.height + 'px' : this.config.height};\n        background: ${this.config.backgroundColor};\n        border-radius: ${this.config.borderRadius}px;\n        box-shadow: ${this.config.boxShadow || '0 8px 32px rgba(0,0,0,0.1)'};\n        display: none;\n        flex-direction: column;\n        overflow: hidden;\n      }\n\n      .chatbot-window.open {\n        display: flex;\n        animation: slideUp 0.3s ease-out;\n      }\n\n      @keyframes slideUp {\n        from { opacity: 0; transform: translateY(10px); }\n        to { opacity: 1; transform: translateY(0); }\n      }\n\n      .chatbot-header {\n        background: ${this.config.primaryColor};\n        color: white;\n        padding: 16px;\n        display: flex;\n        align-items: center;\n        gap: 12px;\n      }\n\n      .chatbot-logo {\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n      }\n\n      .chatbot-header-text h3 {\n        margin: 0;\n        font-size: 16px;\n        font-weight: 600;\n      }\n\n      .chatbot-status {\n        font-size: 12px;\n        opacity: 0.9;\n      }\n\n      .chatbot-close {\n        margin-left: auto;\n        background: none;\n        border: none;\n        color: white;\n        cursor: pointer;\n        padding: 4px;\n        border-radius: 4px;\n      }\n\n      .chatbot-messages {\n        flex: 1;\n        padding: 16px;\n        overflow-y: auto;\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n      }\n\n      .message {\n        max-width: 85%;\n        padding: 8px 12px;\n        border-radius: 12px;\n        font-size: 14px;\n        line-height: 1.4;\n      }\n\n      .message.user {\n        background: ${this.config.primaryColor};\n        color: white;\n        align-self: flex-end;\n        border-bottom-right-radius: 4px;\n      }\n\n      .message.bot {\n        background: #f1f3f5;\n        color: ${this.config.textColor};\n        align-self: flex-start;\n        border-bottom-left-radius: 4px;\n      }\n\n      .chatbot-input {\n        padding: 16px;\n        display: flex;\n        gap: 8px;\n        border-top: 1px solid #e9ecef;\n      }\n\n      .chatbot-input input {\n        flex: 1;\n        padding: 12px;\n        border: 1px solid #e9ecef;\n        border-radius: 20px;\n        outline: none;\n        font-size: 14px;\n      }\n\n      .chatbot-input input:focus {\n        border-color: ${this.config.primaryColor};\n      }\n\n      .chatbot-input button {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        border: none;\n        background: ${this.config.primaryColor};\n        color: white;\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n    `;\n  }\n\n  private bindEvents(): void {\n    if (!this.container) return;\n\n    const trigger = this.container.querySelector('.chatbot-trigger');\n    const closeBtn = this.container.querySelector('.chatbot-close');\n    const sendBtn = this.container.querySelector('#chatbot-send');\n    const input = this.container.querySelector('#chatbot-input') as HTMLInputElement;\n\n    trigger?.addEventListener('click', () => this.toggle());\n    closeBtn?.addEventListener('click', () => this.close());\n    sendBtn?.addEventListener('click', () => this.sendMessage());\n    \n    input?.addEventListener('keypress', (e) => {\n      if (e.key === 'Enter') {\n        this.sendMessage();\n      }\n    });\n  }\n\n  private toggle(): void {\n    if (this._isOpen) {\n      this.close();\n    } else {\n      this.open();\n    }\n  }\n\n  public open(): void {\n    if (!this.container) return;\n    \n    const window = this.container.querySelector('.chatbot-window');\n    window?.classList.add('open');\n    this._isOpen = true;\n    this.emit('open');\n  }\n\n  public close(): void {\n    if (!this.container) return;\n    \n    const window = this.container.querySelector('.chatbot-window');\n    window?.classList.remove('open');\n    this._isOpen = false;\n    this.emit('close');\n  }\n\n  private sendMessage(): void {\n    const input = this.container?.querySelector('#chatbot-input') as HTMLInputElement;\n    const text = input?.value.trim();\n    \n    if (!text) return;\n\n    // Validate message length\n    if (!SecurityUtils.validateLength(text, 1000)) {\n      this.showError('Message is too long. Maximum length is 1000 characters.');\n      return;\n    }\n\n    // Apply rate limiting\n    const userKey = 'user'; // In production, use actual user ID or session ID\n    if (!messageLimiter.checkLimit(userKey, 10, 60000)) { // 10 messages per minute\n      this.showError('Please slow down. You can send up to 10 messages per minute.');\n      return;\n    }\n\n    const message: Message = {\n      id: SecurityUtils.generateSecureId(),\n      text: SecurityUtils.sanitizeHTML(text),\n      sender: 'user',\n      timestamp: new Date()\n    };\n\n    this.addMessage(message);\n    input.value = '';\n    \n    this.emit('message', message);\n    \n    // Note: Bot response should be handled by external API integration\n    // The 'message' event allows external code to handle the API call\n  }\n\n  // Public method to add messages (used both internally and by external API)\n  public addMessage(message: Message): void {\n    this.messages.push(message);\n    this.renderMessage(message);\n    this.scrollToBottom();\n  }\n\n  private renderMessage(message: Message): void {\n    const messagesContainer = this.container?.querySelector('#chatbot-messages');\n    if (!messagesContainer) return;\n\n    const messageEl = document.createElement('div');\n    messageEl.className = `message ${message.sender}`;\n    messageEl.textContent = message.text;\n    \n    messagesContainer.appendChild(messageEl);\n  }\n\n  protected addBotResponse(userMessage: string): void {\n    // Simple response logic (replace with actual bot logic)\n    const responses = [\n      \"Thank you for your message. How can I help you further?\",\n      \"I understand. Let me assist you with that.\",\n      \"That's interesting. Can you tell me more?\",\n      \"I'm here to help! What would you like to know?\"\n    ];\n    \n    const response = responses[Math.floor(Math.random() * responses.length)];\n    \n    this.addMessage({\n      id: SecurityUtils.generateSecureId(),\n      text: SecurityUtils.sanitizeHTML(response),\n      sender: 'bot',\n      timestamp: new Date()\n    });\n  }\n\n  // Public method to show errors (used both internally and by external API)\n  public showError(message: string): void {\n    this.addMessage({\n      id: SecurityUtils.generateSecureId(),\n      text: SecurityUtils.sanitizeHTML(message),\n      sender: 'bot',\n      timestamp: new Date()\n    });\n  }\n\n  protected scrollToBottom(): void {\n    const messagesContainer = this.container?.querySelector('#chatbot-messages');\n    if (messagesContainer) {\n      messagesContainer.scrollTop = messagesContainer.scrollHeight;\n    }\n  }\n\n  protected generateId(): string {\n    return SecurityUtils.generateSecureId();\n  }\n\n  // Event system\n  public on(event: string, callback: Function): void {\n    if (!this.eventListeners.has(event)) {\n      this.eventListeners.set(event, []);\n    }\n    this.eventListeners.get(event)?.push(callback);\n  }\n\n  private emit(event: string, data?: any): void {\n    const listeners = this.eventListeners.get(event);\n    listeners?.forEach(callback => callback(data));\n  }\n\n  // Public API\n  public updateConfig(newConfig: Partial<ChatbotConfig>): void {\n    this.config = { ...this.config, ...newConfig };\n    this.destroy();\n    this.init();\n  }\n\n  public destroy(): void {\n    if (typeof document === 'undefined') return;\n\n    // Clean up event listeners\n    this.eventListeners.clear();\n\n    // Remove DOM elements\n    this.container?.remove();\n    \n    // Remove global styles only if this is the last chatbot instance\n    const existingChatbots = document.querySelectorAll('.chatbot-widget');\n    if (existingChatbots.length <= 1) {\n      const styles = document.getElementById('chatbot-styles');\n      styles?.remove();\n    }\n\n    // Reset state\n    this.container = null;\n    this._isOpen = false;\n    this.messages = [];\n  }\n}","import { ChatbotCore } from './chatbot-core';\nimport { ChatbotConfig, Message } from './types';\nimport { AdvancedChatbotConfig, CustomButton } from './advanced-types';\nimport { SecurityUtils, uploadLimiter, messageLimiter } from './security-utils';\n\n// Enhanced core with API integration\nexport class AdvancedChatbotCore extends ChatbotCore {\n  private typingTimeout?: any;\n  private sessionId: string;\n  private isOnline = true;\n\n  constructor(config: AdvancedChatbotConfig) {\n    super(config);\n    this.sessionId = this.generateSessionId();\n    this.checkOnlineStatus();\n    this.initializeAdvancedFeatures();\n  }\n\n  // Helper to get config as AdvancedChatbotConfig\n  private get advancedConfig(): AdvancedChatbotConfig {\n    return this.config as AdvancedChatbotConfig;\n  }\n\n  private initializeAdvancedFeatures(): void {\n    if (this.advancedConfig.enableFileUpload) {\n      this.addFileUploadButton();\n    }\n    \n    if (this.advancedConfig.quickReplies?.length) {\n      this.addQuickReplies();\n    }\n    \n    if (this.advancedConfig.trackEvents) {\n      this.initializeAnalytics();\n    }\n  }\n\n  private addFileUploadButton(): void {\n    const input = this.container?.querySelector('.chatbot-input');\n    if (!input) return;\n\n    const fileButton = document.createElement('button');\n    fileButton.type = 'button';\n    fileButton.className = 'chatbot-file-btn';\n    fileButton.innerHTML = `\n      <svg width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n        <path d=\"M13.5 3H6.5C5.4 3 4.5 3.9 4.5 5V15C4.5 16.1 5.4 17 6.5 17H13.5C14.6 17 15.5 16.1 15.5 15V5C15.5 3.9 14.6 3 13.5 3Z\" stroke=\"currentColor\" stroke-width=\"2\"/>\n      </svg>\n    `;\n\n    const fileInput = document.createElement('input');\n    fileInput.type = 'file';\n    fileInput.style.display = 'none';\n    \n    // Set secure file upload restrictions\n    const allowedTypes = ['image/jpeg', 'image/png', 'application/pdf'];\n    fileInput.accept = allowedTypes.join(',');\n    \n    fileButton.addEventListener('click', () => fileInput.click());\n    fileInput.addEventListener('change', (e) => this.handleFileUpload(e));\n\n    input.insertBefore(fileButton, input.querySelector('#chatbot-send'));\n    input.appendChild(fileInput);\n  }\n\n  private async handleFileUpload(event: Event): Promise<void> {\n    const input = event.target as HTMLInputElement;\n    const file = input.files?.[0];\n    if (!file) return;\n\n    // Security validations\n    const maxFileSize = 10 * 1024 * 1024; // 10MB\n    const allowedTypes = ['image/jpeg', 'image/png', 'application/pdf', 'text/plain'];\n    \n    // Validate file size\n    if (!SecurityUtils.validateFileSize(file, maxFileSize)) {\n      this.showError('File is too large. Maximum size allowed is 10MB.');\n      input.value = '';\n      return;\n    }\n\n    // Validate file type\n    if (!SecurityUtils.validateFileType(file, allowedTypes)) {\n      this.showError('Invalid file type. Only JPEG, PNG, PDF, and TXT files are allowed.');\n      input.value = '';\n      return;\n    }\n\n    // Check upload rate limit\n    const userKey = 'user'; // In production, use actual user ID or session ID\n    if (!uploadLimiter.checkLimit(userKey, 3, 60000)) { // 3 uploads per minute\n      this.showError('Please slow down. You can upload up to 3 files per minute.');\n      input.value = '';\n      return;\n    }\n\n    // Sanitize filename\n    const sanitizedName = SecurityUtils.sanitizeFileName(file.name);\n\n    // Show upload progress\n    this.showTypingIndicator('Uploading file...');\n\n    try {\n      // Validate API URL before making request\n      if (!this.advancedConfig.apiUrl || !SecurityUtils.validateURL(this.advancedConfig.apiUrl)) {\n        throw new Error('Invalid API URL configuration');\n      }\n\n      const formData = new FormData();\n      formData.append('file', file, sanitizedName);\n      formData.append('sessionId', this.sessionId);\n\n      const response = await fetch(`${this.advancedConfig.apiUrl}/upload`, {\n        method: 'POST',\n        // Don't expose API key in file uploads - should use server-side proxy\n        body: formData,\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const result = await response.json();\n      \n      this.addMessage({\n        id: SecurityUtils.generateSecureId(),\n        text: `Uploaded: ${sanitizedName}`,\n        sender: 'user',\n        timestamp: new Date(),\n        type: 'file',\n      });\n\n      this.hideTypingIndicator();\n      \n    } catch (error) {\n      console.error('File upload failed:', error);\n      this.hideTypingIndicator();\n      this.showError('Sorry, file upload failed. Please try again.');\n    }\n\n    input.value = '';\n  }\n\n  private addQuickReplies(): void {\n    const messagesContainer = this.container?.querySelector('#chatbot-messages');\n    if (!messagesContainer || !this.advancedConfig.quickReplies) return;\n\n    const quickRepliesContainer = document.createElement('div');\n    quickRepliesContainer.className = 'quick-replies';\n    \n    this.advancedConfig.quickReplies.forEach((reply: string) => {\n      const button = document.createElement('button');\n      button.className = 'quick-reply-btn';\n      button.textContent = SecurityUtils.sanitizeHTML(reply);\n      button.addEventListener('click', () => this.sendQuickReply(reply));\n      quickRepliesContainer.appendChild(button);\n    });\n\n    messagesContainer.appendChild(quickRepliesContainer);\n  }\n\n  private sendQuickReply(text: string): void {\n    // Validate and sanitize the quick reply text\n    if (!SecurityUtils.validateLength(text, 500)) {\n      this.showError('Quick reply is too long.');\n      return;\n    }\n\n    const sanitizedText = SecurityUtils.sanitizeHTML(text);\n    \n    this.addMessage({\n      id: SecurityUtils.generateSecureId(),\n      text: sanitizedText,\n      sender: 'user',\n      timestamp: new Date(),\n    });\n\n    // Hide quick replies after use\n    const quickReplies = this.container?.querySelector('.quick-replies') as HTMLElement;\n    if (quickReplies) {\n      quickReplies.style.display = 'none';\n    }\n\n    this.sendToAPI(sanitizedText);\n  }\n\n  private async sendToAPI(message: string): Promise<void> {\n    if (!this.advancedConfig.apiUrl) {\n      this.addBotResponse(message);\n      return;\n    }\n\n    // Validate API URL\n    if (!SecurityUtils.validateURL(this.advancedConfig.apiUrl)) {\n      this.showError('Invalid API configuration.');\n      return;\n    }\n\n    // Apply rate limiting for API calls\n    const userKey = 'user'; // In production, use actual user ID or session ID\n    if (!messageLimiter.checkLimit(userKey, 10, 60000)) { // 10 API calls per minute\n      this.showError('Please slow down. Too many requests.');\n      return;\n    }\n\n    this.showTypingIndicator();\n\n    try {\n      const response = await fetch(this.advancedConfig.apiUrl, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          // Don't expose API keys in client-side code\n          // Should use server-side proxy or token exchange\n        },\n        body: JSON.stringify({\n          message: SecurityUtils.sanitizeHTML(message),\n          sessionId: this.sessionId,\n          userId: this.advancedConfig.userId || 'anonymous',\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`);\n      }\n\n      const data = await response.json();\n      \n      this.hideTypingIndicator();\n      \n      // Sanitize API response\n      const botResponse = SecurityUtils.sanitizeHTML(data.response || data.message || 'I received your message.');\n      \n      this.addMessage({\n        id: SecurityUtils.generateSecureId(),\n        text: botResponse,\n        sender: 'bot',\n        timestamp: new Date(),\n      });\n\n    } catch (error) {\n      console.error('API call failed:', error);\n      this.hideTypingIndicator();\n      \n      if (!this.isOnline) {\n        const offlineMsg = SecurityUtils.sanitizeHTML(\n          this.advancedConfig.offlineMessage || 'Sorry, I\\'m currently offline. Please try again later.'\n        );\n        this.addMessage({\n          id: SecurityUtils.generateSecureId(),\n          text: offlineMsg,\n          sender: 'bot',\n          timestamp: new Date(),\n        });\n      } else {\n        this.showError('Sorry, something went wrong. Please try again.');\n      }\n    }\n  }\n\n  private showTypingIndicator(text = 'Bot is typing...'): void {\n    if (!this.advancedConfig.enableTypingIndicator) return;\n\n    const messagesContainer = this.container?.querySelector('#chatbot-messages');\n    if (!messagesContainer) return;\n\n    // Remove existing typing indicator\n    const existingIndicator = messagesContainer.querySelector('.typing-indicator');\n    if (existingIndicator) {\n      existingIndicator.remove();\n    }\n\n    const indicator = document.createElement('div');\n    indicator.className = 'message bot typing-indicator';\n    \n    // Sanitize the typing text to prevent XSS\n    const safeText = SecurityUtils.sanitizeHTML(text);\n    \n    indicator.innerHTML = `\n      <div class=\"typing-dots\">\n        <span></span>\n        <span></span>\n        <span></span>\n      </div>\n      <small>${safeText}</small>\n    `;\n\n    messagesContainer.appendChild(indicator);\n    this.scrollToBottom();\n  }\n\n  private hideTypingIndicator(): void {\n    const indicator = this.container?.querySelector('.typing-indicator');\n    if (indicator) {\n      indicator.remove();\n    }\n  }\n\n  private checkOnlineStatus(): void {\n    if (typeof window === 'undefined' || typeof navigator === 'undefined') {\n      this.isOnline = true; // Default to online in SSR\n      return;\n    }\n\n    this.isOnline = navigator.onLine;\n    \n    window.addEventListener('online', () => {\n      this.isOnline = true;\n      this.updateConnectionStatus();\n    });\n    \n    window.addEventListener('offline', () => {\n      this.isOnline = false;\n      this.updateConnectionStatus();\n    });\n  }\n\n  private updateConnectionStatus(): void {\n    const status = this.container?.querySelector('.chatbot-status');\n    if (status) {\n      status.textContent = this.isOnline ? 'Online' : 'Offline';\n      status.className = `chatbot-status ${this.isOnline ? 'online' : 'offline'}`;\n    }\n  }\n\n  private initializeAnalytics(): void {\n    this.trackEvent('widget_loaded');\n    \n    this.on('open', () => this.trackEvent('widget_opened'));\n    this.on('close', () => this.trackEvent('widget_closed'));\n    this.on('message', (msg: Message) => {\n      this.trackEvent('message_sent', { \n        sender: msg.sender,\n        messageLength: msg.text.length \n      });\n    });\n  }\n\n  private trackEvent(event: string, data?: any): void {\n    if (!this.advancedConfig.trackEvents || !this.advancedConfig.apiUrl) return;\n\n    // Validate API URL before tracking\n    if (!SecurityUtils.validateURL(this.advancedConfig.apiUrl)) return;\n\n    // Sanitize event data\n    const sanitizedData = data ? SecurityUtils.sanitizeConfig(data) : undefined;\n\n    fetch(`${this.advancedConfig.apiUrl}/analytics`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        // Don't expose API keys - should use server-side proxy\n      },\n      body: JSON.stringify({\n        event: SecurityUtils.sanitizeHTML(event),\n        data: sanitizedData,\n        sessionId: this.sessionId,\n        userId: this.advancedConfig.userId || 'anonymous',\n        timestamp: new Date().toISOString(),\n      }),\n    }).catch(console.error);\n  }\n\n  private generateSessionId(): string {\n    return 'session_' + SecurityUtils.generateSecureId(16);\n  }\n\n  // Enhanced styles for new features\n  protected getEnhancedStyles(): string {\n    return this.getStyles() + `\n      .chatbot-file-btn {\n        width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        border: 1px solid #e9ecef;\n        background: white;\n        color: ${this.config.primaryColor};\n        cursor: pointer;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        margin-right: 8px;\n      }\n\n      .quick-replies {\n        display: flex;\n        flex-wrap: wrap;\n        gap: 8px;\n        margin: 8px 0;\n      }\n\n      .quick-reply-btn {\n        background: white;\n        border: 1px solid ${this.config.primaryColor};\n        color: ${this.config.primaryColor};\n        padding: 6px 12px;\n        border-radius: 16px;\n        cursor: pointer;\n        font-size: 12px;\n        transition: all 0.2s;\n      }\n\n      .quick-reply-btn:hover {\n        background: ${this.config.primaryColor};\n        color: white;\n      }\n\n      .typing-indicator {\n        opacity: 0.8;\n      }\n\n      .typing-dots {\n        display: flex;\n        gap: 4px;\n        margin-bottom: 4px;\n      }\n\n      .typing-dots span {\n        width: 6px;\n        height: 6px;\n        border-radius: 50%;\n        background: ${this.config.primaryColor};\n        animation: typing 1.4s infinite ease-in-out;\n      }\n\n      .typing-dots span:nth-child(2) {\n        animation-delay: 0.2s;\n      }\n\n      .typing-dots span:nth-child(3) {\n        animation-delay: 0.4s;\n      }\n\n      @keyframes typing {\n        0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }\n        40% { opacity: 1; transform: scale(1); }\n      }\n\n      .chatbot-status.offline {\n        color: #dc3545 !important;\n      }\n\n      .chatbot-status.online {\n        color: #28a745 !important;\n      }\n    `;\n  }\n}"],"names":[],"mappings":"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"}